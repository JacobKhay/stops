---
title: "Stops"
author: "Jacob Khaykin"
format: html
execute: 
    echo: false
    warning: false
---
Arrest decisions during traffic stops reflect important patterns in policing outcomes and can vary based on driver characteristics like race. Using traffic stop data from New Orleans collected by the Stanford Open Policing Project with about 400,000 observations from 2011 to 2018, we ask whether arrest rates differ by driver race. One potential weakness of our model is that missing or unmeasured variables, like the reason for the stop, may violate the assumption of unconfoundedness and bias our estimates. We model the probability of arrest, a binary outcome indicating whether a driver was arrested or not, as a linear function of driver sex, race, and their interaction with police zone.


```{r}
#| message: false
library(tidyverse)
library(primer.data)
library(tidymodels)
library(broom)
library(gt)
```

$$
\log\left(\frac{\mathbb{P}(Y = 1)}{1 - \mathbb{P}(Y = 1)}\right) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \cdots + \beta_k X_k
$$

$$
\widehat{\text{arrested}} = 0.177 
+ 0.0614 \cdot \text{sex}_{\text{Male}} 
- 0.0445 \cdot \text{race}_{\text{White}} 
+ 0.0146 \cdot \text{zone}_{\text{B}} 
+ 0.00610 \cdot \text{zone}_{\text{C}} 
+ 0.0781 \cdot \text{zone}_{\text{D}} 
+ 0.00190 \cdot \text{zone}_{\text{E}} 
- 0.00271 \cdot \text{zone}_{\text{F}} 
+ 0.0309 \cdot \text{zone}_{\text{G}} 
+ 0.0757 \cdot \text{zone}_{\text{H}} 
+ \text{(interaction terms for race and zone)}
$$

```{r}
#| cache: true
x <- stops |>
  filter(race %in% c("black", "white")) |>
  mutate(race = str_to_title(race), 
         sex = str_to_title(sex))

fit_stops <- linear_reg() |>
  set_engine("lm") |>
  fit(arrested ~ sex + race * zone, data = x)

tidy(fit_stops, conf.int = TRUE)
```

```{r}
#| label: "model-table"
#| cache: true

tidy(fit_stops, conf.int = TRUE) |>
  select(term, estimate, conf.low, conf.high) |>
  gt() |>
  fmt_number(
    columns = c(estimate, conf.low, conf.high),
    decimals = 3
  ) |>
  cols_label(
    term = "Term",
    estimate = "Estimate",
    conf.low = "Lower 95% CI",
    conf.high = "Upper 95% CI"
  ) |>
  tab_header(
    title = "Model Estimates with 95% Confidence Intervals"
  )
```



